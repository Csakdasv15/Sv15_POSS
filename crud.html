<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Products List</title>
  <script src="../sweetalert.js"></script>
  <script src="../tailwind.js"></script>
</head>
<body class="bg-pink-50 min-h-screen p-6 flex gap-6">
  <!-- Product Form -->
  <form class="w-1/3 bg-white border border-pink-200 rounded-2xl shadow-md p-6 flex flex-col gap-4">
    <h2 class="text-lg font-semibold text-pink-700 border-b pb-2">Add / Edit Product</h2>

    <div>
      <label for="input_name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
      <input type="text" id="input_name" class="w-full border border-pink-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-pink-400 focus:border-pink-400"/>
    </div>

    <div>
      <label for="input_category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
      <select id="input_category" class="w-full border border-pink-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-pink-400 focus:border-pink-400">
        <option value="drink">Drink</option>
        <option value="food">Food</option>
        <option value="water">Water</option>
      </select>
    </div>

    <div>
      <label for="input_price" class="block text-sm font-medium text-gray-700 mb-1">Price</label>
      <input id="input_price" type="number" class="w-full border border-pink-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-pink-400 focus:border-pink-400"/>
    </div>

    <div>
      <label for="profile_ur_url" class="block text-sm font-medium text-gray-700 mb-1">Image URL</label>
      <input id="profile_ur_url" type="url" class="w-full border border-pink-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-pink-400 focus:border-pink-400"/>
    </div>

    <div class="flex justify-between pt-2 border-t">
      <input type="reset" value="Cancel" class="px-4 py-2 text-sm rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 cursor-pointer"/>
      <input type="button" id="btn_add" value="Save" class="px-4 py-2 text-sm rounded-lg bg-pink-600 text-white hover:bg-pink-700 cursor-pointer"/>
    </div>
  </form>

  <!-- Product List -->
  <div class="flex-1 bg-white border border-pink-200 rounded-2xl shadow-md p-6">
    <h1 class="text-xl font-semibold text-pink-700 text-center mb-4 border-b pb-2">Product List</h1>
    
    <!-- Table Header -->
    <div class="grid grid-cols-7 gap-4 text-sm font-medium text-white bg-pink-600 px-4 py-2 rounded-lg">
      <div>#</div>
      <div>Name</div>
      <div>Category</div>
      <div>Price</div>
      <div>Image</div>
      <div class="col-span-2 text-center">Action</div>
    </div>

    <!-- Table Rows -->
    <ul id="main_list" class="divide-y divide-pink-100"></ul>
  </div>

<script>
  let btn_add = document.getElementById('btn_add')
  let main_list = document.getElementById('main_list')
  let input_name = document.getElementById('input_name')
  let input_category = document.getElementById('input_category')
  let input_price = document.getElementById('input_price')
  let profile_ur_url = document.getElementById('profile_ur_url')
  let product_array = getProductList()
  let global_index = null

  renderLi()

  btn_add.addEventListener('click', function(){
    let name = input_name.value
    let category = input_category.value
    let price = input_price.value
    let profile = profile_ur_url.value

    if(name.trim() === ''){
      swal("Must Enter Name!", {icon: "warning"}); return
    }
    if(price.trim() === ''){
      swal("Must Enter Price!", {icon: "warning"}); return
    }
    if(profile.trim() === ''){
      swal("Must Enter URL!", {icon: "warning"}); return
    }

    if (global_index == null){
      product_array.push({name,category,price,profile})
    } else {
      product_array[global_index] = {name,category,price,profile}
      global_index = null
      btn_add.value = "Save"
    }

    localStorage.setItem('product_array', JSON.stringify(product_array))
    renderLi()

    input_name.value = ''
    input_price.value = ''
    profile_ur_url.value = ''
    input_name.focus()
  })

  function editValue(index){
    let current_product = product_array[index]
    global_index = index
    input_name.value = current_product.name
    input_category.value = current_product.category
    input_price.value = current_product.price
    profile_ur_url.value = current_product.profile
    btn_add.value = 'Update'
  }

  function deleteValue(index){
    swal({
      title: "Delete product?",
      text: "Once deleted, you will not be able to recover it!",
      icon: "warning",
      buttons: true,
      dangerMode: true,
    })
    .then((willDelete) => {
      if (willDelete) {
        product_array.splice(index, 1)
        localStorage.setItem('product_array', JSON.stringify(product_array))
        renderLi()
        swal("Product deleted!", {icon: "success"})
      }
    })
  }

  function renderLi(){
    main_list.innerHTML = ''
    product_array.forEach((item, index) => {
      let new_li = document.createElement('li')
      new_li.className = "grid grid-cols-7 gap-4 text-sm px-4 py-3 items-center"
      new_li.innerHTML =`
        <div>${index + 1}.</div>
        <div>${item.name}</div>
        <div>${item.category}</div>
        <div>${item.price}$</div>
        <div><img src="${item.profile}" alt="" class="w-10 h-10 rounded-full border border-pink-300"/></div>
        <div class="col-span-2 flex gap-2 justify-center">
          <button onclick="editValue(${index})" class="px-3 py-1 text-sm rounded-lg bg-pink-100 text-pink-700 hover:bg-pink-200">Edit</button>
          <button onclick="deleteValue(${index})" class="px-3 py-1 text-sm rounded-lg bg-red-100 text-red-700 hover:bg-red-200">Delete</button>
        </div>
      `
      main_list.appendChild(new_li)
    })
  }

  function getProductList(){
    return JSON.parse(localStorage.getItem('product_array') ?? '[]')
  }
</script>
</body>
</html>
